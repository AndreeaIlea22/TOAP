<script type="text/javascript" src="/portality/static/vendor/parsley-2.9.2/parsley.min.js?v={{config.get('DOAJ_VERSION')}}"></script>
<script type="text/javascript" src="/portality/static/vendor/edges/src/edges.js?v={{config.get('DOAJ_VERSION')}}"></script>
<script type="text/javascript" src="/portality/static/js/formulaic.js?v={{config.get('DOAJ_VERSION')}}"></script>
<script type="text/javascript">
    jQuery(document).ready(function($) {
        formulaic.active = formulaic.newFormulaic({
            formSelector: "#{{ form_id }}",
            functions : {{ formulaic_context.javascript_functions|tojson }},
            doValidation : {% if js_validation %}true{% else %}false{% endif %},
            autoSave: {{ auto_save }},
            fieldsets : {{ formulaic_context.ui_settings|tojson }}
        });
});

    let fields = document.getElementsByClassName("conditional");
    for (let f of fields) {
        let inputs = document.getElementsByName(f.getAttribute("name"))
        let conditionValue = f.getAttribute("value")
        let fieldToHide = document.getElementById(f.getAttribute("id").replace("__conditional","")+"__container")
        for (let i = 0; i < inputs.length; i++){
            if (inputs[i].type === "radio") {
                inputs[i].addEventListener("click", function () {
                    if (inputs[i].checked) {
                        if (inputs[i].value === conditionValue) {
                            fieldToHide.style.display = '';
                        } else {
                            fieldToHide.style.display = 'none';
                        }
                    }
                })
            }
            else {
                inputs[i].addEventListener("click", function () {
                    if (inputs[i].value === conditionValue) {
                        if (inputs[i].checked) {
                            fieldToHide.style.display = '';
                        } else {
                            fieldToHide.style.display = 'none';
                        }
                    }
                })
            }
        }
    }
</script>